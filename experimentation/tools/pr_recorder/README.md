# PR recorder script
This is a small script that can be used to record PRs made with Sorald into a
JSON file.

## Requirements
Requires Python 3.8+ and Git 2.x

## Install
Install the packages listed in `requirements.txt`.

```bash
$ python3 -m pip install -r requirements.txt
```

> **Note:** You should do this in a virtual environment to avoid polluting
> system-wide or user packages.

## Usage
One can run the PR recorder by executing the `prrecorder.py` script with Python.

```bash
$ python3 prrecorder.py [options]
```

To show the available commands, run with the `--help` flag.

```
$ python3 prrecorder.py --help
usage: prrecorder.py [-h] {record-initial,record-final,add-manual-edit} ...

positional arguments:
  {record-initial,record-final,add-manual-edit}
    record-initial      make the initial record for a PR
    record-final        make the final record for a PR
    add-manual-edit     add a diff representing a manual edit of a PR

optional arguments:
  -h, --help            show this help message and exit
```

In general, one must always make an initial and final record using the
`record-initial` and `record-final` commands. Running `add-manual-edit` is
optional and allows one to record manual edits performed on the PR, i.e. edits
that were not made with Sorald itself.

The rest of this section contains an example use case of recording the PR
[redhat-developer/rsp-server#619](https://github.com/redhat-developer/rsp-server/pulls/619).

### Step 1: Make the initial record (`record-initial`)
When the PR has been opened, one should make the initial record. It can be done like so.

```
$ python prrecorder.py record-initial \
    --owner redhat-developer \
    --repo-name rsp-server \
    --pr-number 619 \
    --sorald-stats-file stats.json
```

Note that `stats.json` is the statistics file generated by Sorald when running
with statistics collection.

The command executed above creates a file `prs.json` with an initial record
like this:

```
{
    "redhat-developer/rsp-server#619": {
        "repo_slug": "redhat-developer/rsp-server",
        "pr_metadata": {
            "url": "https://github.com/redhat-developer/rsp-server/pull/619",
            "created_at": "2020-11-25 12:01:06",
            "closed_at": null,
            "merged_at": null",
            "state": "open",
            "is_merged": false,
            "number": 619
        },
        "sorald_statistics": {
            "repairs": [
                {
                    "nbPerformedRepairs": 4,
                    "ruleName": "XxeProcessing",
                    "crashedRepairsLocations": [],
                    "nbCrashedRepairs": 0,
                    "ruleKey": "2755",
                    "nbViolationsBefore": 4,
                    "performedRepairsLocations": [
                        {
                            "endLine": 85,
                            "endColumn": 52,
                            "startColumn": 41,
                            "startLine": 85,
                            "filePath": "framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java",
                            "violationSpecifier": "2755:framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java:85:41:85:52"
                        },
                        {
                            "endLine": 92,
                            "endColumn": 70,
                            "startColumn": 59,
                            "startLine": 92,
                            "filePath": "framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java",
                            "violationSpecifier": "2755:framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java:92:59:92:70"
                        },
                        {
                            "endLine": 129,
                            "endColumn": 48,
                            "startColumn": 37,
                            "startLine": 129,
                            "filePath": "framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java",
                            "violationSpecifier": "2755:framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java:129:37:129:48"
                        },
                        {
                            "endLine": 351,
                            "endColumn": 62,
                            "startColumn": 51,
                            "startLine": 351,
                            "filePath": "framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java",
                            "violationSpecifier": "2755:framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java:351:51:351:62"
                        }
                    ],
                    "nbViolationsAfter": 0
                }
            ],
            "executionInfo": {
                "soraldVersion": "commit: 33c4d13b",
                "javaVersion": "11.0.8",
                "originalArgs": [
                    "repair",
                    "--rule-keys",
                    "2755",
                    "--file-output-strategy",
                    "IN_PLACE",
                    "--original-files-path",
                    ".",
                    "--stats-output-file",
                    "stats.json"
                ]
            },
            "totalTimeMs": 11659,
            "repairTimeMs": 315,
            "startTimeMs": 1608221551366,
            "crashes": [],
            "endTimeMs": 1608221563025,
            "parseTimeMs": 2886
        },
        "diffs": {
            "initial": "diff --git a/framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java b/framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java\nindex 26e318d6..e8f3d908 100644\n--- a/framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java\n+++ b/framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java\n@@ -7,6 +7,7 @@\n  * Contributors: Red Hat, Inc.\n  ******************************************************************************/\n package org.jboss.tools.rsp.internal.launching.java.util;\n+import javax.xml.XMLConstants;\n \n import java.io.ByteArrayInputStream;\n import java.io.File;\n@@ -82,7 +83,7 @@\n \tprivate static DocumentBuilder getParser() throws CoreException {\n \t\tif (fgXMLParser == null) {\n \t\t\ttry {\n-\t\t\t\tfgXMLParser = DocumentBuilderFactory.newInstance().newDocumentBuilder();\n+\t\t\t\tfgXMLParser = createDocumentBuilderFactory().newDocumentBuilder();\n \t\t\t\tfgXMLParser.setErrorHandler(new DefaultHandler());\n \t\t\t} catch (ParserConfigurationException e) {\n \t\t\t\tabort(LaunchingPlugin_34, e);\n@@ -348,4 +349,11 @@ protected static void abort(String message, Throwable exception, int code) throw\n \t\tthrow new CoreException(new Status(IStatus.ERROR, IVMInstallChangedListener.LAUNCHING_ID_PLUGIN,\n \t\t\t\tcode, message, exception));\n \t}\n+\n+\tprivate static DocumentBuilderFactory createDocumentBuilderFactory() {\n+\t\tDocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, \"\");\n+\t\treturn factory;\n+\t}\n }\ndiff --git a/framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java b/framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java\nindex 291d3814..92e60d19 100644\n--- a/framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java\n+++ b/framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java\n@@ -89,7 +89,7 @@ public static XMLMemento createReadRoot(InputStream in) {\n \t\t\n \t\tDocument document = null;\n \t\ttry {\t\n-\t\t\tDocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+\t\t\tDocumentBuilderFactory factory = createDocumentBuilderFactory();\n \t\t\tDocumentBuilder parser = factory.newDocumentBuilder();\n \t\t\tdocument = parser.parse(new InputSource(in));\n \t\t\tNode node = document.getFirstChild();\n@@ -126,7 +126,7 @@ private static void logError(Exception t) {\n \tpublic static XMLMemento createWriteRoot(String type) {\n \t\tDocument document;\n \t\ttry {\n-\t\t\tdocument = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();\n+\t\t\tdocument = createDocumentBuilderFactory().newDocumentBuilder().newDocument();\n \t\t\tElement element = document.createElement(type);\n \t\t\tdocument.appendChild(element);\n \t\t\treturn new XMLMemento(document, element);\n@@ -348,7 +348,7 @@ public void save(OutputStream os) throws IOException {\n \t\tResult result = new StreamResult(os);\n \t\tSource source = new DOMSource(factory);\n \t\ttry {\n-\t\t\tTransformerFactory factory = TransformerFactory.newInstance();\n+\t\t\tTransformerFactory factory = createTransformerFactory();\n \t\t\tfactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);\n \t\t\tTransformer transformer = factory.newTransformer();\n \t\t\ttransformer.setOutputProperty(OutputKeys.INDENT, \"yes\"); //$NON-NLS-1$\n@@ -436,4 +436,18 @@ public String getTextData() {\n \t\t}\n \t\treturn \"\"; //$NON-NLS-1$\n \t}\n+\n+\tprivate static DocumentBuilderFactory createDocumentBuilderFactory() {\n+\t\tDocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, \"\");\n+\t\treturn factory;\n+\t}\n+\n+\tprivate static TransformerFactory createTransformerFactory() {\n+\t\tTransformerFactory factory = TransformerFactory.newInstance();\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, \"\");\n+\t\treturn factory;\n+\t}\n }\n\\ No newline at end of file\n",
            "final": null
        },
        "manual_edits": [],
        "record_metadata": {
            "created_at": "2020-12-17 17:19:56.195013",
            "last_modified": "2020-12-17 17:19:56.195013"
        }
    }
}
```

### Step 2: Update the record after PR has been accepted/rejected (`record-final`)

This step really only updates the PR metadata (`closed_at`, `is_merged` etc),  and inserts the `diffs.final` value. Can be executed like so:

```
$ python prrecorder.py record-final \
    --owner redhat-developer \
    --repo-name rsp-server \
    --pr-number 619
```

So it's just like `record-initial`, except that it doesn't take the `--sorald-stats-file` input.

### Step 3 (optional): Record manual edits (`add-manual-edit`)

If we make manual edits to a PR, we need to make note of this. For example, if we make an edit after the PR has been opened, we can record it like so:

```
$ python prrecorder.py add-manual-edit \
    --owner redhat-developer \
    --repo-name rsp-server \
    --pr-number 619 \
    --diff-file diff.txt \
    --edit-type after_open_pr \
    --edit-reason "this can be whatever"
```

This shows up like so in the record:

```
        "manual_edits": [
            {
                "type": "after_open_pr",
                "reason": "this can be whatever",
                "diff": "I didn't actually do any manual edits :)\n"
            }
        ],
```

### Final result

After these three command shave been executed, my `prs.json` looks like this:

```{
    "redhat-developer/rsp-server#619": {
        "repo_slug": "redhat-developer/rsp-server",
        "pr_metadata": {
            "url": "https://github.com/redhat-developer/rsp-server/pull/619",
            "created_at": "2020-11-25 12:01:06",
            "closed_at": "2020-11-30 20:45:38",
            "merged_at": "2020-11-30 20:45:38",
            "state": "closed",
            "is_merged": true,
            "number": 619
        },
        "sorald_statistics": {
            "repairs": [
                {
                    "nbPerformedRepairs": 4,
                    "ruleName": "XxeProcessing",
                    "crashedRepairsLocations": [],
                    "nbCrashedRepairs": 0,
                    "ruleKey": "2755",
                    "nbViolationsBefore": 4,
                    "performedRepairsLocations": [
                        {
                            "endLine": 85,
                            "endColumn": 52,
                            "startColumn": 41,
                            "startLine": 85,
                            "filePath": "framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java",
                            "violationSpecifier": "2755:framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java:85:41:85:52"
                        },
                        {
                            "endLine": 92,
                            "endColumn": 70,
                            "startColumn": 59,
                            "startLine": 92,
                            "filePath": "framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java",
                            "violationSpecifier": "2755:framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java:92:59:92:70"
                        },
                        {
                            "endLine": 129,
                            "endColumn": 48,
                            "startColumn": 37,
                            "startLine": 129,
                            "filePath": "framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java",
                            "violationSpecifier": "2755:framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java:129:37:129:48"
                        },
                        {
                            "endLine": 351,
                            "endColumn": 62,
                            "startColumn": 51,
                            "startLine": 351,
                            "filePath": "framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java",
                            "violationSpecifier": "2755:framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java:351:51:351:62"
                        }
                    ],
                    "nbViolationsAfter": 0
                }
            ],
            "executionInfo": {
                "soraldVersion": "commit: 33c4d13b",
                "javaVersion": "11.0.8",
                "originalArgs": [
                    "repair",
                    "--rule-keys",
                    "2755",
                    "--file-output-strategy",
                    "IN_PLACE",
                    "--original-files-path",
                    ".",
                    "--stats-output-file",
                    "stats.json"
                ]
            },
            "totalTimeMs": 11659,
            "repairTimeMs": 315,
            "startTimeMs": 1608221551366,
            "crashes": [],
            "endTimeMs": 1608221563025,
            "parseTimeMs": 2886
        },
        "diffs": {
            "initial": "diff --git a/framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java b/framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java\nindex 26e318d6..e8f3d908 100644\n--- a/framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java\n+++ b/framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java\n@@ -7,6 +7,7 @@\n  * Contributors: Red Hat, Inc.\n  ******************************************************************************/\n package org.jboss.tools.rsp.internal.launching.java.util;\n+import javax.xml.XMLConstants;\n \n import java.io.ByteArrayInputStream;\n import java.io.File;\n@@ -82,7 +83,7 @@\n \tprivate static DocumentBuilder getParser() throws CoreException {\n \t\tif (fgXMLParser == null) {\n \t\t\ttry {\n-\t\t\t\tfgXMLParser = DocumentBuilderFactory.newInstance().newDocumentBuilder();\n+\t\t\t\tfgXMLParser = createDocumentBuilderFactory().newDocumentBuilder();\n \t\t\t\tfgXMLParser.setErrorHandler(new DefaultHandler());\n \t\t\t} catch (ParserConfigurationException e) {\n \t\t\t\tabort(LaunchingPlugin_34, e);\n@@ -348,4 +349,11 @@ protected static void abort(String message, Throwable exception, int code) throw\n \t\tthrow new CoreException(new Status(IStatus.ERROR, IVMInstallChangedListener.LAUNCHING_ID_PLUGIN,\n \t\t\t\tcode, message, exception));\n \t}\n+\n+\tprivate static DocumentBuilderFactory createDocumentBuilderFactory() {\n+\t\tDocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, \"\");\n+\t\treturn factory;\n+\t}\n }\ndiff --git a/framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java b/framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java\nindex 291d3814..92e60d19 100644\n--- a/framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java\n+++ b/framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java\n@@ -89,7 +89,7 @@ public static XMLMemento createReadRoot(InputStream in) {\n \t\t\n \t\tDocument document = null;\n \t\ttry {\t\n-\t\t\tDocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+\t\t\tDocumentBuilderFactory factory = createDocumentBuilderFactory();\n \t\t\tDocumentBuilder parser = factory.newDocumentBuilder();\n \t\t\tdocument = parser.parse(new InputSource(in));\n \t\t\tNode node = document.getFirstChild();\n@@ -126,7 +126,7 @@ private static void logError(Exception t) {\n \tpublic static XMLMemento createWriteRoot(String type) {\n \t\tDocument document;\n \t\ttry {\n-\t\t\tdocument = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();\n+\t\t\tdocument = createDocumentBuilderFactory().newDocumentBuilder().newDocument();\n \t\t\tElement element = document.createElement(type);\n \t\t\tdocument.appendChild(element);\n \t\t\treturn new XMLMemento(document, element);\n@@ -348,7 +348,7 @@ public void save(OutputStream os) throws IOException {\n \t\tResult result = new StreamResult(os);\n \t\tSource source = new DOMSource(factory);\n \t\ttry {\n-\t\t\tTransformerFactory factory = TransformerFactory.newInstance();\n+\t\t\tTransformerFactory factory = createTransformerFactory();\n \t\t\tfactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);\n \t\t\tTransformer transformer = factory.newTransformer();\n \t\t\ttransformer.setOutputProperty(OutputKeys.INDENT, \"yes\"); //$NON-NLS-1$\n@@ -436,4 +436,18 @@ public String getTextData() {\n \t\t}\n \t\treturn \"\"; //$NON-NLS-1$\n \t}\n+\n+\tprivate static DocumentBuilderFactory createDocumentBuilderFactory() {\n+\t\tDocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, \"\");\n+\t\treturn factory;\n+\t}\n+\n+\tprivate static TransformerFactory createTransformerFactory() {\n+\t\tTransformerFactory factory = TransformerFactory.newInstance();\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, \"\");\n+\t\treturn factory;\n+\t}\n }\n\\ No newline at end of file\n",
            "final": "diff --git a/framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java b/framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java\nindex 26e318d6..e8f3d908 100644\n--- a/framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java\n+++ b/framework/bundles/org.jboss.tools.rsp.launching.java/src/main/java/org/jboss/tools/rsp/internal/launching/java/util/LaunchingSupportUtils.java\n@@ -7,6 +7,7 @@\n  * Contributors: Red Hat, Inc.\n  ******************************************************************************/\n package org.jboss.tools.rsp.internal.launching.java.util;\n+import javax.xml.XMLConstants;\n \n import java.io.ByteArrayInputStream;\n import java.io.File;\n@@ -82,7 +83,7 @@\n \tprivate static DocumentBuilder getParser() throws CoreException {\n \t\tif (fgXMLParser == null) {\n \t\t\ttry {\n-\t\t\t\tfgXMLParser = DocumentBuilderFactory.newInstance().newDocumentBuilder();\n+\t\t\t\tfgXMLParser = createDocumentBuilderFactory().newDocumentBuilder();\n \t\t\t\tfgXMLParser.setErrorHandler(new DefaultHandler());\n \t\t\t} catch (ParserConfigurationException e) {\n \t\t\t\tabort(LaunchingPlugin_34, e);\n@@ -348,4 +349,11 @@ protected static void abort(String message, Throwable exception, int code) throw\n \t\tthrow new CoreException(new Status(IStatus.ERROR, IVMInstallChangedListener.LAUNCHING_ID_PLUGIN,\n \t\t\t\tcode, message, exception));\n \t}\n+\n+\tprivate static DocumentBuilderFactory createDocumentBuilderFactory() {\n+\t\tDocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, \"\");\n+\t\treturn factory;\n+\t}\n }\ndiff --git a/framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java b/framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java\nindex 291d3814..92e60d19 100644\n--- a/framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java\n+++ b/framework/bundles/org.jboss.tools.rsp.launching/src/main/java/org/jboss/tools/rsp/launching/memento/XMLMemento.java\n@@ -89,7 +89,7 @@ public static XMLMemento createReadRoot(InputStream in) {\n \t\t\n \t\tDocument document = null;\n \t\ttry {\t\n-\t\t\tDocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+\t\t\tDocumentBuilderFactory factory = createDocumentBuilderFactory();\n \t\t\tDocumentBuilder parser = factory.newDocumentBuilder();\n \t\t\tdocument = parser.parse(new InputSource(in));\n \t\t\tNode node = document.getFirstChild();\n@@ -126,7 +126,7 @@ private static void logError(Exception t) {\n \tpublic static XMLMemento createWriteRoot(String type) {\n \t\tDocument document;\n \t\ttry {\n-\t\t\tdocument = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();\n+\t\t\tdocument = createDocumentBuilderFactory().newDocumentBuilder().newDocument();\n \t\t\tElement element = document.createElement(type);\n \t\t\tdocument.appendChild(element);\n \t\t\treturn new XMLMemento(document, element);\n@@ -348,7 +348,7 @@ public void save(OutputStream os) throws IOException {\n \t\tResult result = new StreamResult(os);\n \t\tSource source = new DOMSource(factory);\n \t\ttry {\n-\t\t\tTransformerFactory factory = TransformerFactory.newInstance();\n+\t\t\tTransformerFactory factory = createTransformerFactory();\n \t\t\tfactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);\n \t\t\tTransformer transformer = factory.newTransformer();\n \t\t\ttransformer.setOutputProperty(OutputKeys.INDENT, \"yes\"); //$NON-NLS-1$\n@@ -436,4 +436,18 @@ public String getTextData() {\n \t\t}\n \t\treturn \"\"; //$NON-NLS-1$\n \t}\n+\n+\tprivate static DocumentBuilderFactory createDocumentBuilderFactory() {\n+\t\tDocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, \"\");\n+\t\treturn factory;\n+\t}\n+\n+\tprivate static TransformerFactory createTransformerFactory() {\n+\t\tTransformerFactory factory = TransformerFactory.newInstance();\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n+\t\tfactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, \"\");\n+\t\treturn factory;\n+\t}\n }\n\\ No newline at end of file\n"
        },
        "manual_edits": [
            {
                "type": "after_open_pr",
                "reason": "this can be whatever",
                "diff": "I didn't actually do any manual edits :)\n"
            }
        ],
        "record_metadata": {
            "created_at": "2020-12-17 17:19:56.195013",
            "last_modified": "2020-12-17 17:29:41.391090"
        }
    }
}
```
